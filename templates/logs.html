{% extends "base.html" %}

{% block title %}Live Logs{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/log.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="{{ url_for('static', filename='java-script/log.js') }}"></script>
<script src="{{ url_for('static', filename='java-script/export.js') }}"></script>
{% endblock %}

{% block content %}
<div class="logs-shell">
    <aside class="filters">
        <div class="filters-header">Filters</div>

        <div class="filter-group">
            <button class="filter-section open" type="button" data-toggle="timeline">
                <span>Timeline</span><i class="fa-solid fa-chevron-down"></i>
            </button>
            <div class="filter-body open" id="timeline">
                <div class="select-like">
                    <form method="get" id="dayForm">
                        <input type="hidden" name="day" id="dayHidden">
                        <button type="button" id="dayPicker">
                            <i class="fa-regular fa-calendar"></i>
                            <span id="dayLabel">{{ selected_day }}</span>
                            <i class="fa-solid fa-chevron-down chevron"></i>
                        </button>
                        <div class="dropdown" id="dayDropdown">
                            {% for folder in log_folders %}
                                <div class="dropdown-item" data-day="{{ folder }}">{{ folder }}</div>
                            {% endfor %}
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="filter-group">
          <button class="filter-section open" type="button" data-toggle="levels">
            <span>Contains Level</span><i class="fa-solid fa-chevron-down"></i>
          </button>
          <div class="filter-body open" id="levels">
            <label class="chk">
              <input type="checkbox" class="lvl" value="DEBUG">
              <span class="badge debug">DEBUG</span>
              <b class="count" id="count-debug">0</b>
            </label>
            <label class="chk">
              <input type="checkbox" class="lvl" value="INFO">
              <span class="badge info">INFO</span>
              <b class="count" id="count-info">0</b>
            </label>
            <label class="chk">
              <input type="checkbox" class="lvl" value="WARN">
              <span class="badge warn">WARN</span>
              <b class="count" id="count-warn">0</b>
            </label>
            <label class="chk">
              <input type="checkbox" class="lvl" value="ERROR">
              <span class="badge error">ERROR</span>
              <b class="count" id="count-error">0</b>
            </label>
            <label class="chk">
              <input type="checkbox" class="lvl" value="CRITICAL">
              <span class="badge critical">CRITICAL</span>
              <b class="count" id="count-critical">0</b>
            </label>
          </div>
        </div>

        <div class="filter-group">
            <button class="filter-section open" type="button" data-toggle="types">
                <span>Sources</span><i class="fa-solid fa-chevron-down"></i>
            </button>
            <div class="filter-body open" id="types"></div>
        </div>

        <div class="last-updated" id="lastUpdated">Last updated just now</div>
    </aside>

    <main class="logs-main">
        <div class="topbar">
            <div class="search-wrap">
                <i class="fa-solid fa-magnifying-glass"></i>
                <input id="searchInput" type="text" placeholder="Searchâ€¦">
            </div>
            <div class="topbar-actions">
              <button id="resetBtn" class="ghost"><i class="fa-regular fa-circle"></i> Reset Filter</button>
              <button id="refreshBtn" class="icon" title="Refresh"><i class="fa-solid fa-rotate-right"></i> Refresh</button>
              <button id="liveBtn" class="pill on"><i class="fa-solid fa-play"></i> Live</button>
              <button id="moreBtn" class="icon" title="More"><i class="fa-solid fa-ellipsis-vertical"></i></button>
            </div>
            
            <div id="moreMenu" class="action-menu" hidden>
              <div class="menu-title">Actions</div>
              <button class="menu-item" data-ext="log">Export to .log</button>
              <button class="menu-item" data-ext="txt">Export to .txt</button>
            </div>
        </div>

        <div class="table-wrap" id="tableScroll">
            <table class="logs-table" id="logsTable">
                <thead>
                    <tr>
                        <th class="ts">Timestamp</th>
                        <th class="lvl">Level</th>
                        <th class="msg">Message</th>
                        <th class="src">Source</th>
                    </tr>
                </thead>
                <tbody id="logsBody"></tbody>
            </table>
        </div>
    </main>
</div>

{% endblock %}